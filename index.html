<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultima Check Tool - Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0b10;
            --panel: #13151b;
            --primary: #00f2ff;
            --success: #00ff9d;
            --error: #ff0055;
            --text: #e0e6ed;
            --border: #2a2f3d;
        }
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Rajdhani', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Header & Stats */
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background: rgba(19, 21, 27, 0.9); border-bottom: 1px solid var(--border); backdrop-filter: blur(10px); }
        .logo { font-size: 24px; font-weight: 800; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 10px rgba(0, 242, 255, 0.5); }
        
        .user-panel { display: flex; gap: 20px; align-items: center; }
        .stat-box { background: #000; padding: 5px 15px; border-radius: 4px; border: 1px solid var(--border); font-family: 'Roboto Mono', monospace; font-size: 14px; }
        .stat-box span { color: var(--primary); font-weight: bold; }
        .stat-box.danger span { color: var(--error); }
        
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 999; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        #loginInput { padding: 15px; width: 300px; background: #000; border: 2px solid var(--primary); color: white; font-size: 18px; text-align: center; border-radius: 5px; margin-bottom: 20px; }
        
        /* Main Layout */
        .main-container { display: flex; flex: 1; padding: 20px; gap: 20px; height: calc(100vh - 70px); }
        
        /* Left: Input */
        .input-section { flex: 1; display: flex; flex-direction: column; gap: 15px; max-width: 400px; }
        .glass-panel { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); display: flex; flex-direction: column; height: 100%; }
        
        h3 { margin: 0 0 15px 0; color: var(--text); font-size: 18px; text-transform: uppercase; border-left: 4px solid var(--primary); padding-left: 10px; }
        
        textarea { flex: 1; background: #08090c; border: 1px solid var(--border); color: #a0aec0; padding: 15px; resize: none; border-radius: 8px; font-family: 'Roboto Mono', monospace; font-size: 13px; line-height: 1.5; transition: 0.3s; }
        textarea:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 242, 255, 0.1); color: white; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 6px; font-weight: 700; cursor: pointer; text-transform: uppercase; font-family: 'Rajdhani', sans-serif; font-size: 16px; transition: 0.2s; position: relative; overflow: hidden; }
        
        .btn-start { background: linear-gradient(135deg, #00b4db 0%, #0083b0 100%); color: white; box-shadow: 0 4px 15px rgba(0, 180, 219, 0.3); }
        .btn-start:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 180, 219, 0.5); }
        .btn-start:active { transform: translateY(0); }
        .btn-start:disabled { background: #333; color: #666; cursor: not-allowed; transform: none; box-shadow: none; }
        
        /* Right: Output */
        .output-section { flex: 2; display: flex; flex-direction: column; height: 100%; }
        .result-list { flex: 1; overflow-y: auto; padding-right: 5px; display: flex; flex-direction: column; gap: 8px; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }
        
        /* Result Item Card */
        .res-item { background: #1a1d26; padding: 12px 15px; border-radius: 6px; border-left: 4px solid #555; font-family: 'Roboto Mono', monospace; font-size: 13px; display: flex; align-items: center; justify-content: space-between; animation: slideIn 0.3s ease; }
        .res-item.success { border-left-color: var(--success); background: rgba(0, 255, 157, 0.05); }
        .res-item.error { border-left-color: var(--error); background: rgba(255, 0, 85, 0.05); color: #ff88a0; }
        
        .res-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 90%; }
        .copy-btn { background: transparent; border: 1px solid #444; color: #888; padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer; }
        .copy-btn:hover { border-color: var(--primary); color: var(--primary); }

        .summary-bar { margin-top: 15px; padding: 15px; background: #13151b; border-radius: 8px; display: flex; justify-content: space-between; border: 1px solid var(--border); font-weight: bold; }
        .sum-ok { color: var(--success); }
        .sum-fail { color: var(--error); }

        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <h2 style="color: var(--primary); margin-bottom: 20px;">X√ÅC TH·ª∞C NG∆Ø·ªúI D√ôNG</h2>
        <input type="text" id="loginInput" placeholder="Nh·∫≠p ID User (VD: 7239343492)">
        <button class="btn-start" style="width: 200px;" onclick="login()">TRUY C·∫¨P</button>
        <p style="color: #666; font-size: 12px; margin-top: 10px;">D·ªØ li·ªáu ƒë·ªçc t·ª´ database.js</p>
    </div>

    <header>
        <div class="logo">‚ö° ULTIMA TOOL</div>
        <div class="user-panel">
            <div class="stat-box">ID: <span id="displayId">---</span></div>
            <div class="stat-box" id="turnBox">L∆Ø·ª¢T: <span id="displayTurns">---</span></div>
        </div>
    </header>

    <div class="main-container">
        <div class="input-section">
            <div class="glass-panel">
                <h3>üì¶ DANH S√ÅCH T√ÄI KHO·∫¢N</h3>
                <textarea id="inputList" placeholder="Nh·∫≠p danh s√°ch (M·ªói d√≤ng 1 tk|mk)...&#10;user1|pass1&#10;user2|pass2"></textarea>
                <div class="btn-group">
                    <button id="btnStop" class="btn-start" style="background: #333; display: none;" onclick="stopCheck()">D·ª™NG L·∫†I</button>
                    <button id="btnCheck" class="btn-start" onclick="startCheck()">B·∫ÆT ƒê·∫¶U CHECK</button>
                </div>
                <div style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
                    T·ª± ƒë·ªông x√≥a d√≤ng khi check xong
                </div>
            </div>
        </div>

        <div class="output-section">
            <div class="glass-panel" style="padding: 0; background: transparent; border: none; box-shadow: none;">
                <div class="result-list" id="resultContainer">
                    </div>
                
                <div class="summary-bar">
                    <div>TH√ÄNH C√îNG: <span id="countOk" class="sum-ok">0</span></div>
                    <div>TH·∫§T B·∫†I: <span id="countFail" class="sum-fail">0</span></div>
                </div>
            </div>
        </div>
    </div>

    <script src="database.js"></script>
    <script>
        // --- C·∫§U H√åNH ---
        const WORKER_URL = 'https://proud-art-e32c.qdev09.workers.dev/'; // Thay link worker c·ªßa b·∫°n
        
        let currentUser = null;
        let isRunning = false;
        let stopSignal = false;
        let stats = { ok: 0, fail: 0 };

        // 1. Logic ƒêƒÉng nh·∫≠p (Gi·∫£ l·∫≠p ƒë·ªçc t·ª´ database.js)
        function login() {
            const id = document.getElementById('loginInput').value.trim();
            if (!VIP_DATABASE[id]) {
                alert("‚ùå ID kh√¥ng t·ªìn t·∫°i ho·∫∑c ch∆∞a ƒëƒÉng k√Ω!");
                return;
            }
            
            currentUser = {
                id: id,
                data: VIP_DATABASE[id] // L·∫•y d·ªØ li·ªáu t·ª´ file database.js
            };

            // Ki·ªÉm tra h·∫°n s·ª≠ d·ª•ng
            const expiry = new Date(currentUser.data.expiry);
            const now = new Date();
            
            // Logic ∆∞u ti√™n: N·∫øu c√≤n h·∫°n ng√†y -> Kh√¥ng tr·ª´ l∆∞·ª£t. N·∫øu h·∫øt h·∫°n -> Tr·ª´ l∆∞·ª£t.
            // Nh∆∞ng theo y√™u c·∫ßu c·ªßa b·∫°n: "M·ªói l·∫ßn check -1 l∆∞·ª£t".
            // V·∫≠y ta ch·ªâ quan t√¢m ƒë·∫øn turns.
            
            if (currentUser.data.turns <= 0) {
                alert("‚ö†Ô∏è T√†i kho·∫£n ƒë√£ h·∫øt l∆∞·ª£t s·ª≠ d·ª•ng (0 turns).");
                return;
            }

            document.getElementById('displayId').innerText = id;
            updateTurnDisplay();
            document.getElementById('loginOverlay').style.display = 'none';
        }

        function updateTurnDisplay() {
            const turnSpan = document.getElementById('displayTurns');
            const box = document.getElementById('turnBox');
            turnSpan.innerText = currentUser.data.turns;
            
            if (currentUser.data.turns < 10) box.classList.add('danger');
            else box.classList.remove('danger');
        }

        // 2. Logic Check
        async function startCheck() {
            const textArea = document.getElementById('inputList');
            let lines = textArea.value.split('\n').filter(line => line.trim() !== "");

            if (lines.length === 0) {
                alert("‚ö†Ô∏è Danh s√°ch tr·ªëng!");
                return;
            }
            
            if (currentUser.data.turns <= 0) {
                alert("‚õî H·∫æT L∆Ø·ª¢T! Vui l√≤ng n·∫°p th√™m.");
                return;
            }

            // Reset tr·∫°ng th√°i
            isRunning = true;
            stopSignal = false;
            document.getElementById('btnCheck').style.display = 'none';
            document.getElementById('btnStop').style.display = 'block';
            textArea.disabled = true;

            // V√≤ng l·∫∑p x·ª≠ l√Ω
            for (let i = 0; i < lines.length; i++) {
                if (stopSignal || currentUser.data.turns <= 0) break;

                const line = lines[i];
                if (!line.includes('|')) {
                    addResult(line, "Sai ƒë·ªãnh d·∫°ng", false);
                    continue; // B·ªè qua d√≤ng l·ªói
                }

                const [user, pass] = line.split('|');
                
                // G·ªçi API
                const result = await checkAccount(user.trim(), pass.trim());
                
                // Tr·ª´ l∆∞·ª£t (D√π ƒë√∫ng hay sai)
                currentUser.data.turns--;
                updateTurnDisplay();

                // X·ª≠ l√Ω k·∫øt qu·∫£
                if (result.status === 'success') {
                    // Format k·∫øt qu·∫£ 1 d√≤ng
                    const d = result.data;
                    const oneLine = `${d.username}|${d.password} | Rank: ${d.rank} | Skin: ${d.skin} | T∆∞·ªõng: ${d.tuong} | Login: ${d.lslogin}`;
                    
                    addResult(oneLine, null, true);
                    stats.ok++;
                    
                    // X√≥a d√≤ng ƒë√£ check th√†nh c√¥ng kh·ªèi textarea
                    // Ta l·∫•y gi√° tr·ªã hi·ªán t·∫°i, remove d√≤ng ƒë√≥
                    const currentText = textArea.value;
                    const newText = currentText.replace(line + "\n", "").replace(line, ""); 
                    textArea.value = newText.trim();
                } else {
                    addResult(`${user}|${pass}`, result.msg || "L·ªói check", false);
                    stats.fail++;
                    // Gi·ªØ l·∫°i d√≤ng l·ªói (ho·∫∑c x√≥a t√πy b·∫°n, code n√†y ƒëang gi·ªØ l·∫°i d√≤ng l·ªói ƒë·ªÉ user bi·∫øt sai con n√†o)
                }

                // C·∫≠p nh·∫≠t th·ªëng k√™
                document.getElementById('countOk').innerText = stats.ok;
                document.getElementById('countFail').innerText = stats.fail;

                // Delay nh·∫π ƒë·ªÉ kh√¥ng spam server
                await new Promise(r => setTimeout(r, 500));
            }

            stopCheck();
        }

        async function checkAccount(account, password) {
            try {
                const response = await fetch(WORKER_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ account, password })
                });
                return await response.json();
            } catch (e) {
                return { status: 'error', msg: "L·ªói m·∫°ng/API" };
            }
        }

        function stopCheck() {
            isRunning = false;
            stopSignal = true;
            document.getElementById('btnCheck').style.display = 'block';
            document.getElementById('btnStop').style.display = 'none';
            document.getElementById('inputList').disabled = false;
            
            if (currentUser.data.turns <= 0) {
                alert("‚ö†Ô∏è ƒê√£ h·∫øt l∆∞·ª£t s·ª≠ d·ª•ng. D·ª´ng tool.");
            }
        }

        // 3. Hi·ªÉn th·ªã k·∫øt qu·∫£
        function addResult(text, errorMsg, isSuccess) {
            const container = document.getElementById('resultContainer');
            const div = document.createElement('div');
            div.className = `res-item ${isSuccess ? 'success' : 'error'}`;
            
            const content = isSuccess ? text : `${text} -> [${errorMsg}]`;
            
            div.innerHTML = `
                <div class="res-text" title="${content}">${content}</div>
                <button class="copy-btn" onclick="navigator.clipboard.writeText('${content}')">COPY</button>
            `;
            
            // Th√™m v√†o ƒë·∫ßu danh s√°ch
            container.insertBefore(div, container.firstChild);
        }
    </script>
</body>
</html>
